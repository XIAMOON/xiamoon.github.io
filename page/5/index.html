<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="人生不止眼前的苟且 还有诗和远方">
<meta property="og:type" content="website">
<meta property="og:title" content="李乾的博客">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="李乾的博客">
<meta property="og:description" content="人生不止眼前的苟且 还有诗和远方">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="李乾的博客">
<meta name="twitter:description" content="人生不止眼前的苟且 还有诗和远方">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title>李乾的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李乾的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">上海攻城狮一枚</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/07/第四篇，Category-和-Extension/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李乾">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李乾的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/07/第四篇，Category-和-Extension/" itemprop="url">第四篇、Category 和 Extension</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-07T00:00:00+08:00">
                2017-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS面试总结及研究/" itemprop="url" rel="index">
                    <span itemprop="name">iOS面试总结及研究</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、Category"><a href="#一、Category" class="headerlink" title="一、Category"></a>一、Category</h3><blockquote>
<p>本文属于转载加笔记补充</p>
</blockquote>
<h4 id="1、原文出处"><a href="#1、原文出处" class="headerlink" title="1、原文出处"></a>1、原文出处</h4><p><a href="http://tech.meituan.com/DiveIntoCategory.html" target="_blank" rel="noopener">原文链接</a><br><a href="http://tech.meituan.com/" target="_blank" rel="noopener">相关技术博客</a></p>
<h4 id="2、原文摘抄-笔记"><a href="#2、原文摘抄-笔记" class="headerlink" title="2、原文摘抄+笔记"></a>2、原文摘抄+笔记</h4><p><strong>category简介</strong></p>
<blockquote>
<p>category是Objective-C 2.0之后添加的语言特性，category的主要作用是为已经存在的类添加方法。除此之外，apple还推荐了category的另外两个使用场景：</p>
<ul>
<li>可以把类的实现分开在几个不同的文件里面。这样做有几个显而易见的好处，(a)可以减少单个文件的体积 (b)可以&gt;把不同的功能组织到不同的category里 (c)可以由多个开发者共同完成一个类 d)可以按需加载想要的category 等等。</li>
<li>声明私有方法</li>
</ul>
</blockquote>
<blockquote>
<p>不过除了apple推荐的使用场景，广大开发者脑洞大开，还衍生出了category的其他几个使用场景：</p>
<ul>
<li>模拟多继承</li>
<li>把framework的私有方法公开</li>
</ul>
</blockquote>
<blockquote>
<p>Objective-C的这个语言特性对于纯动态语言来说可能不算什么，比如javascript，你可以随时为一个“类”或者对象添加&gt;任意方法和实例变量。但是对于不是那么“动态”的语言而言，这确实是一个了不起的特性。</p>
</blockquote>
<p><strong>category和extension</strong></p>
<blockquote>
<ul>
<li>extension看起来很像一个匿名的category，但是extension和有名字的category几乎完全是两个东西。<br>extension在编译器决议，它就是类的一部分，在编译期和头文件里的@interface以及实现文件里的@implement一起形成一个完整的类，它伴随类的产生而产生，亦随之一起消亡。extension一般用来隐藏类的私有信息，你必须有一个类的源码才能为一个类添加extension，所以你无法为系统类如 NSString添加extension。</li>
<li>但是category则完全不一样，它是在运行期决议的。<br>就category和extension的区别来看，我们可以推导出一个明显的事实，extension可以添加实例变量，而category是无法添加实例变量的（因为在运行期，对象的内存布局已经确定，如果添加实例变量就会破坏类的内部布局，这对编译型语言来说是灾难性的）。<br><code>疑问：那为什么就可以添加属性和方法呢？难道这不会破坏对象的内存布局？</code><br><code>答：</code></li>
</ul>
</blockquote>
<h4 id="（3）总结"><a href="#（3）总结" class="headerlink" title="（3）总结"></a>（3）总结</h4><hr>
<h3 id="二、Extension"><a href="#二、Extension" class="headerlink" title="二、Extension"></a>二、Extension</h3><p>未完待续<br>几个链接：<br><a href="http://www.cocoachina.com/ios/20170406/19001.html" target="_blank" rel="noopener">http://www.cocoachina.com/ios/20170406/19001.html</a><br><a href="http://www.jianshu.com/p/7d54b832c68b" target="_blank" rel="noopener">http://www.jianshu.com/p/7d54b832c68b</a><br><a href="http://blog.csdn.net/csdnliming147/article/details/53365159" target="_blank" rel="noopener">http://blog.csdn.net/csdnliming147/article/details/53365159</a><br><a href="http://www.cnblogs.com/Mike-zh/p/5143904.html" target="_blank" rel="noopener">http://www.cnblogs.com/Mike-zh/p/5143904.html</a></p>
<p>百度搜索：为什么category不能添加成员变量</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      


        
        <div>
        
        
        </div>
        


    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/05/C语言内存分配/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李乾">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李乾的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/05/C语言内存分配/" itemprop="url">C语言内存分配</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T00:00:00+08:00">
                2017-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C语言/" itemprop="url" rel="index">
                    <span itemprop="name">C语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>一般情况下，一个可执行二进制程序(更确切的说，在Linux操作系统下为一个进程单元，在UC/OSII中被称为任务)在存储(没有调入到内存运行)时拥有3个部分，分别是代码段(text)、数据段(data)和BSS段。这3个部分一起组成了该可执行程序的文件。</p>
</blockquote>
<h3 id="C语言可执行代码结构"><a href="#C语言可执行代码结构" class="headerlink" title="C语言可执行代码结构"></a>C语言可执行代码结构</h3><table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">代码段</td>
<td style="text-align:center">可执行代码、字符串常量</td>
</tr>
<tr>
<td style="text-align:center">数据段</td>
<td style="text-align:center">已初始化全局变量、已初始化全局静态变量、局部静态变量、常量数据       </td>
</tr>
<tr>
<td style="text-align:center">BSS段</td>
<td style="text-align:center">未初始化全局变量、未初始化全局静态变量</td>
</tr>
<tr>
<td style="text-align:center">栈</td>
<td style="text-align:center">局部变量。函数参数</td>
</tr>
<tr>
<td style="text-align:center">堆</td>
<td style="text-align:center">动态内存分配</td>
</tr>
</tbody>
</table>
<p><strong>(1)代码段(text segment)：</strong>存放CPU执行的机器指令。通常代码段是可共享的，这使得需要频繁被执行的程序只需要在内存中拥有一份拷贝即可。代码段也通常是只读的，这样可以防止其他程序意外地修改其指令。另外，代码段还规划了局部数据所申请的内存空间信息。<br><code>代码段（code segment/text segment）</code>通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读, 某些架构也允许代码段为可写，即允许修改程序。在代码段中，也有可能包含一些只读的常数变量，例如字符串常量等。</p>
<p><strong>(2)数据段(data segment)：</strong>或称全局初始化数据段/静态数据段(initialized data segment/data segment)。该段包含了在程序中明确被初始化的全局变量、静态变量(包括全局静态变量和局部静态变量)和常量数据。</p>
<p><strong>(3)未初始化数据段：</strong>亦称BSS(Block Started by Symbol)。该段存入的是全局未初始化变量、静态未初始化变量。<br>而当程序被加载到内存单元时，则需要另外两个域：堆域和栈域。</p>
<p><strong>(4)栈段(stack)：</strong>存放函数的参数值、局部变量的值，以及在进行任务切换时存放当前任务的上下文内容。</p>
<p><strong>(5)堆段(heap)：</strong>用于动态内存分配，即使用malloc/free系列函数来管理的内存空间。<br>在将应用程序加载到内存空间执行时，操作系统负责代码段、数据段和BSS段的加载，并将在内存中为这些段分配空间。栈段亦由操作系统分配和管理，而不需要程序员显示地管理；堆段由程序员自己管理，即显示地申请和释放空间。</p>
<p>另外，可执行程序在运行时具有相应的程序属性。在有操作系统支持时，这些属性页由操作系统管理和维护。</p>
<p>下面给出示例程序代码，注释已经在代码中写明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/*代码段、数据段和BSS段存储变量类型*/</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">const int    g_A       = 10;            //代码段</span><br><span class="line">int            g_B      = 20;            //数据段</span><br><span class="line">static int    g_C       = 30;            //数据段</span><br><span class="line">static int    g_D;                    //BSS段</span><br><span class="line">int            g_E;                    //BSS段</span><br><span class="line">char        *p1;                    //BSS段</span><br><span class="line">void main( )</span><br><span class="line">&#123;</span><br><span class="line">int           local_A;            //栈</span><br><span class="line">static int    local_C = 0;        //数据段</span><br><span class="line">static int    local_D;            //数据段</span><br><span class="line"></span><br><span class="line">char        *p3 = &quot;123456&quot;;     //123456在代码段，p3在栈上</span><br><span class="line">p1 = (char *)malloc( 10 );      //堆，分配得来得10字节的区域在堆区</span><br><span class="line">strcpy( p1, &quot;123456&quot; );         //123456&#123;post.content&#125;放在常量区，编译器可能会将它与p3所指向 的&quot;123456&quot;优化成一块</span><br><span class="line">printf(&quot;\n&quot;);</span><br><span class="line">printf( &quot;代码段,全局初始化变量, 只读const,  g_A,     addr:0x%08x\n&quot;, &amp;g_A);</span><br><span class="line">printf(&quot;\n&quot;);</span><br><span class="line">printf( &quot;数据段,全局变量,       初始化      g_B,     addr:0x%08x\n&quot;, &amp;g_B);</span><br><span class="line">printf( &quot;数据段,静态全局变量,   初始化,     g_C,     addr:0x%08x\n&quot;, &amp;g_C);</span><br><span class="line">printf(&quot;\n&quot;);</span><br><span class="line">printf( &quot;BSS段, 全局变量,       未初始化    g_E,     addr:0x%08x\n&quot;, &amp;g_E, g_E );    </span><br><span class="line">printf( &quot;BSS段, 静态全局变量,   未初始化,   g_D,     addr:0x%08x\n&quot;, &amp;g_D );</span><br><span class="line">printf( &quot;BSS段, 静态局部变量,   初始化,     local_C, addr:0x%08x\n&quot;, &amp;local_C);</span><br><span class="line">printf( &quot;BSS段, 静态局部变量,   未初始化,   local_D, addr:0x%08x\n&quot;, &amp;local_D);</span><br><span class="line">printf(&quot;\n&quot;);</span><br><span class="line">printf( &quot;栈,    局部变量,                   local_A, addr:0x%08x\n&quot;, &amp;local_A );</span><br><span class="line">printf(&quot;\n&quot;);</span><br><span class="line">printf( &quot;堆,    malloc分配内存,             p1,      addr:0x%08x\n&quot;, p1 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>个人觉得 代码段、数据段、BSS段可以统称为：<strong>静态区</strong>。</p>
<blockquote>
<p>所以，对于程序员，一般来说，我们可以简单的理解为内存分为三个部分：<strong>静态区，栈，堆</strong>。<br><strong>静态区</strong>：保存自动全局变量和static变量（包括static全局和局部变量）。静态区的内容在整个程序的生命周期内都存在，由编译器在编译的时候分配。<br><strong>栈</strong>：保存局部变量。栈上的内容只在函数的范围内存在，当函数运行结束，这些内容也会自动被销毁。其特点是效率高，但空间大小有限。<br><strong>堆</strong>：由malloc()系列函数或new操作符分配的内存。其生命周期有free货delete决定。</p>
</blockquote>
<h3 id="二、延伸。关键字：static、"><a href="#二、延伸。关键字：static、" class="headerlink" title="二、延伸。关键字：static、"></a>二、延伸。关键字：static、</h3><h4 id="1、static关键字，能够改变声明周期和改变作用域。"><a href="#1、static关键字，能够改变声明周期和改变作用域。" class="headerlink" title="1、static关键字，能够改变声明周期和改变作用域。"></a>1、<code>static</code>关键字，能够改变声明周期和改变作用域。</h4><p>(1)static 用来声明局部变量。局部变量的作用域一般在{}内，在函数内部使用，<strong>局部变量是存储在栈区的(用malloc()函数创建的存储在堆区</strong>。代码指令执行到变量的定义处才会给变量分配内存来存储，跳出代码块{}(即 作用域)后，变量所在的内存会释放(由操作系统来自动释放)。但是当用static关键字修饰后(如变量：local_C、local_D)，会改变变量的存储方式(<strong>存在静态区</strong>)，也就是，使变量成为<strong>静态区的局部变量</strong>。所以<strong>改变了变量的生命周期</strong>，其生命周期持续到程序退出，此时其内存单元才会被释放。(变量会具有记忆功能，可以记忆上次的值)。<br><strong>总结：局部变量加static修饰后还是局部变量，作用域没变，只是存储方式变了，所以生命周期就变了。</strong><br>其他解释：static 表示静态的变量，分配内存的时候, 存储在静态区,不存储在栈上面。</p>
<p>(2)static 用来声明外部变量。外部变量指在所有代码块{}之外定义的变量，<strong>存储在静态区</strong>，编译时分配内存，程序结束时释放内存单元。同时其作用域很广，整个文件都有效甚至别的文件也能引用它。为了限制某些外部变量的作用域，使其只在本文件中有效，而不能被其他文件引用，可以用<code>static</code>关键字对其作出声明。<br><strong>总结：存储方式没变，会改变其连接方式，使其只在本文件内部有效，而其他文件不可连接或引用该变量。</strong></p>
<p>(3)static 作用于函数。跟作用于外部变量一样。对函数的<strong>连接方式</strong>产生影响，使得函数<strong>只在本文件内部有效</strong>，对其他文件是不可见的。这样的函数又叫作<strong>静态函数</strong>。使用静态函数的好处是，不用担心与其他文件的同名函数产生干扰，另外也是对函数本身的一种保护机制。<br>　　如果想要其他文件可以引用本地函数，则要在函数定义时使用关键字extern，表示该函数是外部函数，可供其他文件调用。另外在要引用别的文件中定义的外部函数的文件中，使用extern声明要用的外部函数即可。
　　</p>
<h4 id="2、const关键字，其作用相当于“只读”，readonly。"><a href="#2、const关键字，其作用相当于“只读”，readonly。" class="headerlink" title="2、const关键字，其作用相当于“只读”，readonly。"></a>2、<code>const</code>关键字，其作用相当于“只读”，readonly。</h4><p>　　</p>
<h4 id="3、extern关键字，其作用使得变量可以在文件外部被访问。"><a href="#3、extern关键字，其作用使得变量可以在文件外部被访问。" class="headerlink" title="3、extern关键字，其作用使得变量可以在文件外部被访问。"></a>3、<code>extern</code>关键字，其作用使得变量可以在文件外部被访问。</h4><p>　　看c++代码：<br>　　<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">　　// test1.cpp文件</span><br><span class="line">　　char g_str[] = &quot;123456&quot;; // 定义全局变量g_str</span><br><span class="line">　　void fun1() &#123; </span><br><span class="line">　　cout &lt;&lt; g_str &lt;&lt; endl; </span><br><span class="line">　　&#125;</span><br><span class="line">　　</span><br><span class="line">　　-------------------------------------------------------------------</span><br><span class="line">　　// test2.cpp文件</span><br><span class="line">　　extern char g_str[]; // 声明全局变量g_str。告诉编译器，g_str是在别的文件定义的</span><br><span class="line">　　void fun2() &#123; </span><br><span class="line">　　cout &lt;&lt; g_str &lt;&lt; endl;    </span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上演示的是extern的作用，在test2.cpp中用test1.cpp文件中定义的变量g_str。<br>但是一般这样写不好，因为如果我在test3.cpp、test4.cpp…文件中也想用到g_str这个变量，我的在每个文件中都用extern来声明这个变量。所以一般正确的写法是这样的。<br>　　<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">　　// test1.h文件</span><br><span class="line">　　#ifndef TEST1H</span><br><span class="line">　　#define TEST1H</span><br><span class="line">　　extern char g_str[]; // 声明全局变量g_str</span><br><span class="line">　　void fun1();</span><br><span class="line">　　#endif</span><br><span class="line">　　</span><br><span class="line">　　-------------------------------------------------------------------</span><br><span class="line">　　// test1.cpp文件</span><br><span class="line">　　#include &quot;test1.h&quot;</span><br><span class="line">　　</span><br><span class="line">　　char g_str[] = &quot;123456&quot;; // 定义全局变量g_str</span><br><span class="line">　　void fun1() &#123; </span><br><span class="line">　　cout &lt;&lt; g_str &lt;&lt; endl; </span><br><span class="line">　　&#125;</span><br><span class="line">　　</span><br><span class="line">　　-------------------------------------------------------------------</span><br><span class="line">　　// test2.cpp文件</span><br><span class="line">　　#include &quot;test1.h&quot;</span><br><span class="line">　　</span><br><span class="line">　　void fun2() &#123; </span><br><span class="line">　　cout &lt;&lt; g_str &lt;&lt; endl;    </span><br><span class="line">　　&#125;</span><br><span class="line">　　</span><br><span class="line">　　-------------------------------------------------------------------</span><br><span class="line">　　// test3.cpp文件</span><br><span class="line">　　#include &quot;test1.h&quot;</span><br><span class="line">　　</span><br><span class="line">　　void fun3() &#123; </span><br><span class="line">　　cout &lt;&lt; g_str &lt;&lt; endl;    </span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>对于上面的结果，也有人这样说过：<br>假如a.h中有 int a=10; t1.cpp和t2.cpp同时include “a.h”则编译不成功，因为a重复定义；<br>如果 a.h中是 static int a=10;则可以，因为t1和t2中的a只是名字相同，地址空间不同；<br>如果a.h中是 extern int a; 并且在a.cpp中 int a=10; 则t1和t2中的a指向同一个地址空间。</p>
</blockquote>
<p>extern可以置于变量或者函数前，以标示变量或者函数的定义在别的文件中，提示编译器遇到此变量和函数时在其他模块中寻找其定义。此外extern也可用来进行链接指定。<br>其他解释：extern 表明该变量在别的地方已经定义过了,在这里要使用那个变量。</p>
<p>未完待续，百度搜索：c语言内存分配<br>　　<br><a href="http://blog.csdn.net/u013553529/article/details/50629055" target="_blank" rel="noopener"> Haroopad Markdown 编辑器代码语法高亮支持</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      


        
        <div>
        
        
        </div>
        


    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/05/第三篇、所有权修饰符：strong、weak/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李乾">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李乾的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/05/第三篇、所有权修饰符：strong、weak/" itemprop="url">第三篇、所有权修饰符：strong、weak</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T00:00:00+08:00">
                2017-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS面试总结及研究/" itemprop="url" rel="index">
                    <span itemprop="name">iOS面试总结及研究</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、-strong定义的解释"><a href="#一、-strong定义的解释" class="headerlink" title="一、__strong定义的解释"></a>一、__strong定义的解释</h3><h4 id="1、定义：-strong修饰符表示对对象的强引用。持有强引用的变量在超出其作用域时被废弃，随着强引用的失效，引用的对象也会随之释放。"><a href="#1、定义：-strong修饰符表示对对象的强引用。持有强引用的变量在超出其作用域时被废弃，随着强引用的失效，引用的对象也会随之释放。" class="headerlink" title="1、定义：__strong修饰符表示对对象的强引用。持有强引用的变量在超出其作用域时被废弃，随着强引用的失效，引用的对象也会随之释放。"></a>1、定义：<code>__strong</code>修饰符表示对对象的<code>强引用</code>。持有强引用的变量在超出其作用域时被废弃，随着强引用的失效，引用的对象也会随之释放。</h4><p><code>__strong</code>是<code>id</code>类型或者对象模型默认的所有权修饰符，如，一般我们写：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</span><br></pre></td></tr></table></figure></p>
<p><code>id</code>和对象类型在没有明确指定所有权修饰符时，默认为<code>__strong</code>修饰符，所以，上面的代码等效于：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</span><br></pre></td></tr></table></figure></p>
<h4 id="2、强引用后的对象在出了它的作用域后会被自动销毁"><a href="#2、强引用后的对象在出了它的作用域后会被自动销毁" class="headerlink" title="2、强引用后的对象在出了它的作用域后会被自动销毁"></a>2、强引用后的对象在出了它的作用域后会被自动销毁</h4><p>(1) 对于自己创建并持有的对象<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 变量obj超出其作用域，强引用失效，自动释放自己持有的对象</span></span><br></pre></td></tr></table></figure></p>
<p>(2) 对于非自己生成并持有的对象<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">//继续持有该对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 变量obj超出其作用域，强引用失效，自动释放自己持有的对象</span></span><br></pre></td></tr></table></figure></p>
<h4 id="3、强引用之间的赋值"><a href="#3、强引用之间的赋值" class="headerlink" title="3、强引用之间的赋值"></a>3、强引用之间的赋值</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// obj0持有对象A的强引用</span></span><br><span class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj0 = [[<span class="built_in">NSObject</span> alloc] init]; <span class="comment">// 对象A</span></span><br><span class="line"><span class="comment">// obj1持有对象B的强引用</span></span><br><span class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj1 = [[<span class="built_in">NSObject</span> alloc] init]; <span class="comment">// 对象B</span></span><br><span class="line"><span class="comment">// obj2不持有任何对象</span></span><br><span class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj2 = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj0持有由obj1创建并持有的对象B的强引用，类似于MRC的 [B retain];</span></span><br><span class="line"><span class="comment">// 而因为obj0被赋值，所以原先持有的对象A的强引用失效。</span></span><br><span class="line"><span class="comment">// 对象A的所有者不存在，因此对象A废弃，类似于MRC的 [A release];</span></span><br><span class="line">obj0 = obj1;</span><br><span class="line">obj2 = obj0;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时持有对象B的强引用变量为：obj0、obj1和obj2。retainCount = 3;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj1 = <span class="literal">nil</span>; <span class="comment">// 类似于MRC的 [B release]; retainCount = 2;</span></span><br><span class="line">obj0 = <span class="literal">nil</span>; <span class="comment">// 类似于MRC的 [B release]; retainCount = 1;</span></span><br><span class="line">obj2 = <span class="literal">nil</span>; <span class="comment">// 类似于MRC的 [B release]; retainCount = 0; // 对象B被销毁</span></span><br></pre></td></tr></table></figure>
<h4 id="4、用-strong联想到OC的内存管理"><a href="#4、用-strong联想到OC的内存管理" class="headerlink" title="4、用__strong联想到OC的内存管理"></a>4、用<code>__strong</code>联想到OC的内存管理</h4><ul>
<li>自己生成的对象，自己持有。 (只需通过对带有__strong修饰符的变量赋值即可达成要求)</li>
<li>非自己生成的对象，自己也能持有。 (只需通过对带有__strong修饰符的变量赋值即可达成要求)</li>
<li>自己持有的对象不再需要时，释放。(很显然，带有__strong修饰符的变量，在超出其作用域时，会自动释放)</li>
<li>非自己持有的对象无法释放。(MRC下需要调用release，ARC下不会发生)</li>
</ul>
<p>看起来通过<strong>strong已经可以完美的进行内存管理，其实不然，下面来看`</strong>weak`。</p>
<h3 id="二、-weak定义的解释"><a href="#二、-weak定义的解释" class="headerlink" title="二、__weak定义的解释"></a>二、__weak定义的解释</h3><h4 id="1、使用场景：循环引用。引用计数式的内存管理中必然会发生“循环引用”的问题。"><a href="#1、使用场景：循环引用。引用计数式的内存管理中必然会发生“循环引用”的问题。" class="headerlink" title="1、使用场景：循环引用。引用计数式的内存管理中必然会发生“循环引用”的问题。"></a>1、使用场景：循环引用。引用计数式的内存管理中必然会发生“循环引用”的问题。</h4><h4 id="2、定义：-weak修饰符与-strong修饰符相反，提供弱引用。弱引用不能持有对象实例。"><a href="#2、定义：-weak修饰符与-strong修饰符相反，提供弱引用。弱引用不能持有对象实例。" class="headerlink" title="2、定义：__weak修饰符与__strong修饰符相反，提供弱引用。弱引用不能持有对象实例。"></a>2、定义：<code>__weak</code>修饰符与<code>__strong</code>修饰符相反，提供弱引用。弱引用不能持有对象实例。</h4><h4 id="3、看代码"><a href="#3、看代码" class="headerlink" title="3、看代码"></a>3、看代码</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一般此时，编译器会发出警告，对于自己创建的对象，带有__weak修饰符的变量会被立即释放</span></span><br><span class="line">__<span class="keyword">weak</span> <span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</span><br></pre></td></tr></table></figure>
<p>需要这样写<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">__<span class="keyword">strong</span> <span class="keyword">id</span> obj0 = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">__<span class="keyword">weak</span> <span class="keyword">id</span> obj1 = obj0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="4、weak修饰符还有另一优点。在持有某对象的弱引用时，若该对象被废弃，则此弱引用将自动失效且处于nil被复制的状态（空弱引用）。weak只能在iOS5以后使用。在iOS4时，只能用-unsafe-unretained修饰符来代替。"><a href="#4、weak修饰符还有另一优点。在持有某对象的弱引用时，若该对象被废弃，则此弱引用将自动失效且处于nil被复制的状态（空弱引用）。weak只能在iOS5以后使用。在iOS4时，只能用-unsafe-unretained修饰符来代替。" class="headerlink" title="4、weak修饰符还有另一优点。在持有某对象的弱引用时，若该对象被废弃，则此弱引用将自动失效且处于nil被复制的状态（空弱引用）。weak只能在iOS5以后使用。在iOS4时，只能用__unsafe_unretained修饰符来代替。"></a>4、<strong>weak修饰符还有另一优点。在持有某对象的弱引用时，若该对象被废弃，则此弱引用将自动失效且处于nil被复制的状态（空弱引用）。</strong>weak只能在iOS5以后使用。在iOS4时，只能用__unsafe_unretained修饰符来代替。</h4><p>问题来了：对象回收时Weak指针自动被置为nil的实现原理是什么？<br>我们都知道Weak指针不会增加所引用对象的计数，并在引用对象被回收的时候自动被置为nil。通常用于解决循环引用问题。那么，自动被置为nil内部是如何实现的呢？</p>
<p>内部实现 —— Weak表（一个哈希表）<br>Runtime维护了一个Weak表，用于存储指向某个对象的所有Weak指针。Weak表其实是一个哈希表，Key是所指对象的地址，Value是Weak指针的地址（这个地址的值是所指对象的地址）的数组。</p>
<p>在对象被回收的时候，经过层层调用，会最终触发下面的方法将所有Weak指针的值设为nil。(具体定义在objc-weak.m中)<br>看代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PRIVATE_EXTERN void </span><br><span class="line">arr_clear_deallocating(weak_table_t *weak_table, id referent) &#123;</span><br><span class="line">&#123;</span><br><span class="line">weak_entry_t *entry = weak_entry_for_referent(weak_table, referent);</span><br><span class="line">if (entry == NULL) &#123;</span><br><span class="line">/// XXX shouldn&apos;t happen, but does with mismatched CF/objc</span><br><span class="line">//printf(&quot;XXX no entry for clear deallocating %p\n&quot;, referent);</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">// zero out references</span><br><span class="line">for (int i = 0; i &lt; entry-&gt;referrers.num_allocated; ++i) &#123;</span><br><span class="line">id *referrer = entry-&gt;referrers.refs[i].referrer;</span><br><span class="line">if (referrer) &#123;</span><br><span class="line">if (*referrer == referent) &#123;</span><br><span class="line">*referrer = nil;</span><br><span class="line">&#125;</span><br><span class="line">else if (*referrer) &#123;</span><br><span class="line">_objc_inform(&quot;__weak variable @ %p holds %p instead of %p\n&quot;, referrer, *referrer, referent);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">weak_entry_remove_no_lock(weak_table, entry);</span><br><span class="line">weak_table-&gt;num_weak_refs--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>简单来说，这个方法首先根据对象地址获取所以Weak指针地址的数组，然后遍历这个数组把其中的数据设为nil，最后把这个entry从Weak表中删除。</p>
<p>这里只简单说说对象回收时，Weak指针如何设为nil，至于Weak指针如何注册到Weak表中、如何维护可以参考objc-weak.m中的其它源码。从实现中可以看出，Weak指针的使用涉及到Hash表的增删改查，有一定的性能开销。</p>
<h3 id="三、参考文章"><a href="#三、参考文章" class="headerlink" title="三、参考文章"></a>三、参考文章</h3><p>1、<code>Object-C高级编程 IOS与OS X多线程和内存管理</code><br>2、<a href="http://blog.chinaunix.net/uid-29588729-id-4228137.html" target="_blank" rel="noopener">oc中变量的作用域及存储位置</a>。<br>3、<a href="https://opensource.apple.com/source/objc4/objc4-646/" target="_blank" rel="noopener">objc4/objc4-646</a>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      


        
        <div>
        
        
        </div>
        


    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/25/第二篇、对runtime的研究/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李乾">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李乾的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/25/第二篇、对runtime的研究/" itemprop="url">第二篇、对runtime的研究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-25T00:00:00+08:00">
                2017-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS面试总结及研究/" itemprop="url" rel="index">
                    <span itemprop="name">iOS面试总结及研究</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="首先祭出一道面试题及其答案："><a href="#首先祭出一道面试题及其答案：" class="headerlink" title="首先祭出一道面试题及其答案："></a>首先祭出一道面试题及其答案：</h3><h4 id="1-你使用过Objective-C的运行时编程（Runtime-Programming）么？如果使用过，你用它做了什么？你还能记得你所使用的相关的头文件或者某些方法的名称吗？"><a href="#1-你使用过Objective-C的运行时编程（Runtime-Programming）么？如果使用过，你用它做了什么？你还能记得你所使用的相关的头文件或者某些方法的名称吗？" class="headerlink" title="1. 你使用过Objective-C的运行时编程（Runtime Programming）么？如果使用过，你用它做了什么？你还能记得你所使用的相关的头文件或者某些方法的名称吗？"></a>1. 你使用过Objective-C的运行时编程（Runtime Programming）么？如果使用过，你用它做了什么？你还能记得你所使用的相关的头文件或者某些方法的名称吗？</h4><p>答案：Objecitve-C的重要特性是Runtime（运行时）,在#import &lt;objc/runtime.h&gt; 下能看到相关的方法，用过objc_getClass()和class_copyMethodList()获取过私有API;使用<br>objective-c<br>Method method1 = class_getInstanceMethod(cls, sel1);<br>Method method2 = class_getInstanceMethod(cls, sel2);<br>method_exchangeImplementations(method1, method2);<br>代码交换两个方法，在写unit test时使用到。</p>
<p>当然，答案归答案，还是需要对runtime进行深层次的理解的。<br>runtime.h源码阅读、见解及尝试</p>
<h3 id="一、参考文章"><a href="#一、参考文章" class="headerlink" title="一、参考文章"></a>一、参考文章</h3><p>1、<a href="http://www.jianshu.com/p/927c8384855a" target="_blank" rel="noopener">iOS~runtime理解</a><br>2、<a href="http://www.cnblogs.com/tekkaman/archive/2013/02/25/2931984.html" target="_blank" rel="noopener">为什么要在编译头中加<strong>OBJC</strong></a><br>3、<a href="http://www.cocoachina.com/ios/20141224/10740.html" target="_blank" rel="noopener">刨根问底Objective-C Runtime</a></p>
<p>通过研究runtime而搜到的其他有用的文章<br>1、<a href="http://www.jianshu.com/p/eb03e20f7b1c" target="_blank" rel="noopener">iOS消除对应的警告</a></p>
<h3 id="二、相关问题产生"><a href="#二、相关问题产生" class="headerlink" title="二、相关问题产生"></a>二、相关问题产生</h3><h4 id="1、为什么说OC是运行时语言？"><a href="#1、为什么说OC是运行时语言？" class="headerlink" title="1、为什么说OC是运行时语言？"></a>1、为什么说OC是运行时语言？</h4><p>答：</p>
<h4 id="2、如何把oc代码转写成c-c-代码？"><a href="#2、如何把oc代码转写成c-c-代码？" class="headerlink" title="2、如何把oc代码转写成c/c++代码？"></a>2、如何把oc代码转写成c/c++代码？</h4><p>答：先用文本编辑器编写一段代码纯文本，把文件存储为<em>.m文件，然后打开终端，来到文件所在的目录，执行命令：clang -rewrite-objc </em>.m，执行后，目录会多出一个*.cpp文件，就可以看到c/c++代码了。</p>
<h3 id="三、源码解读"><a href="#三、源码解读" class="headerlink" title="三、源码解读"></a>三、源码解读</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2、类的定义</span></span><br><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">Class isa              OBJC_ISA_AVAILABILITY; <span class="comment">// 类Class的isa指向该类的元类metaClass，如 Son isa (MetaClass of Son)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#if !__OBJC2__    </span></span><br><span class="line">Class super_class                                        OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">// 成员变量列表    </span></span><br><span class="line"><span class="keyword">struct</span> objc_ivar_list *ivars                             OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">// 方法列表</span></span><br><span class="line"><span class="keyword">struct</span> objc_method_list **methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">// 缓存，是一种优化，调用过的方法存入缓存列表，下次调用之前先找缓存</span></span><br><span class="line"><span class="keyword">struct</span> </span><br><span class="line">objc_cache *cache                                 OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="keyword">struct</span> objc_protocol_list *protocols                     OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">/* Use `Class` instead of `struct objc_class *` */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、对象的定义</span></span><br><span class="line"><span class="keyword">struct</span> </span><br><span class="line">objc_object &#123;</span><br><span class="line">Class isa  OBJC_ISA_AVAILABILITY;   <span class="comment">// 对象的isa指向它所属的类，如  son isa Son</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Use `id` instead of `struct objc_object *` */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object *<span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OBJC_ARC_UNAVAILABLE：<span class="comment">//指在ARC下无法使用</span></span><br></pre></td></tr></table></figure>
<p>（1）我们发现，OC的对象其实就是C语言的结构体。OC是对C语言的封装，只是在C语言的层面上加了一些关键字和语法。OC的强大之处在于它的运行时。核心是消息分发。<br>（2）isa顾名思义，表示是什么。实例instance的isa指向类Class，类Class的isa指向该类的元类metaClass，但是看objc_class结构体可以知道，metaClass也有个isa，这个isa指向MetaClass of NSObject，而MetaClass of NSObject的isa指向它自己，形成一个循环。objc_class结构体里还有super_class，每个metaClass的super_class指向它原本Class的super_class的metaClass，而最上层的MetaClass of NSObject的super_class指向类NSObject，最上层的NSObject的super_class指向nil，也形成一个闭环。可以参考下图：<br><img src="/source/summary2_p_1.jpg" alt=""></p>
<h3 id="四、一些常用方法"><a href="#四、一些常用方法" class="headerlink" title="四、一些常用方法"></a>四、一些常用方法</h3><h4 id="1、获取一个类的属性名称"><a href="#1、获取一个类的属性名称" class="headerlink" title="1、获取一个类的属性名称"></a>1、获取一个类的属性名称</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count;</span><br><span class="line">objc_property_t *propertyList = class_copyPropertyList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">objc_property_t property = propertyList[i];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *propertyName = property_getName(property);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"property----&gt;%@"</span>, [<span class="built_in">NSString</span> stringWithUTF8String:propertyName]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、获取一个类的成员变量名称"><a href="#2、获取一个类的成员变量名称" class="headerlink" title="2、获取一个类的成员变量名称"></a>2、获取一个类的成员变量名称</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count;</span><br><span class="line">Ivar *ivarList = class_copyIvarList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Ivar ivar = ivarList[i];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *ivarName = ivar_getName(ivar);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ivar----&gt;%@"</span>, [<span class="built_in">NSString</span> stringWithUTF8String:ivarName]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3、获取一个类的方法名称"><a href="#3、获取一个类的方法名称" class="headerlink" title="3、获取一个类的方法名称"></a>3、获取一个类的方法名称</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count;</span><br><span class="line">Method *methodList = class_copyMethodList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Method method = methodList[i];</span><br><span class="line">SEL selName = method_getName(method);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"method----&gt;%@"</span>, <span class="built_in">NSStringFromSelector</span>(selName));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4、获取一个类的协议方法名"><a href="#4、获取一个类的协议方法名" class="headerlink" title="4、获取一个类的协议方法名"></a>4、获取一个类的协议方法名</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count;</span><br><span class="line">__<span class="keyword">unsafe_unretained</span> Protocol **protocolList = class_copyProtocolList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i; i&lt;count; i++) &#123;</span><br><span class="line">Protocol *myProtocal = protocolList[i];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *protocolName = protocol_getName(myProtocal);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"protocol----&gt;%@"</span>, [<span class="built_in">NSString</span> stringWithUTF8String:protocolName]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5、方法交换-如果觉得系统的方法写的不好，可以自己写一个方法替换掉系统的方法，这个方法很实用"><a href="#5、方法交换-如果觉得系统的方法写的不好，可以自己写一个方法替换掉系统的方法，这个方法很实用" class="headerlink" title="5、方法交换 如果觉得系统的方法写的不好，可以自己写一个方法替换掉系统的方法，这个方法很实用"></a>5、方法交换 如果觉得系统的方法写的不好，可以自己写一个方法替换掉系统的方法，这个方法很实用</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSString</span> (<span class="title">Addition</span>)</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)test_myLowerString;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSString</span> (<span class="title">Addition</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)test_myLowerString</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">NSString</span> *lowercase = [<span class="keyword">self</span> test_myLowerString];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@ =&gt;%@"</span>,<span class="keyword">self</span>,lowercase);</span><br><span class="line"><span class="keyword">return</span> lowercase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>如果我们想把这个类与系统的lowercase替换该如何做呢？<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *testString = <span class="string">@"TEST"</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@,"</span>,[testString lowercaseString]);</span><br><span class="line"></span><br><span class="line">Method originMethod = class_getInstanceMethod([<span class="built_in">NSString</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(lowercaseString));</span><br><span class="line">Method swapMethod = class_getInstanceMethod([<span class="built_in">NSString</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(test_myLowerString));</span><br><span class="line">method_exchangeImplementations(originMethod, swapMethod);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[testString lowercaseString]);</span><br></pre></td></tr></table></figure></p>
<h4 id="6、自己的一个测试"><a href="#6、自己的一个测试" class="headerlink" title="6、自己的一个测试"></a>6、自己的一个测试</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSObject</span> *obj = [<span class="built_in">NSObject</span> new];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"*****  %@"</span>, <span class="built_in">NSStringFromClass</span>([<span class="built_in">NSObject</span> <span class="keyword">class</span>])); <span class="comment">// [NSObject class] 等效 NSObject.self</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"*****  %@"</span>, <span class="built_in">NSStringFromClass</span>([obj <span class="keyword">class</span>])); <span class="comment">// [obj class] 等效 obj.dynamicType</span></span><br><span class="line"></span><br><span class="line">两者都是输出：<span class="built_in">NSObject</span></span><br><span class="line"><span class="comment">// 方法实现</span></span><br><span class="line">+ (Class)<span class="keyword">class</span> &#123; <span class="comment">// 返回类本身</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Class)<span class="keyword">class</span> &#123; <span class="comment">// 返回实例的isa</span></span><br><span class="line"><span class="keyword">return</span> object_getClass(<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上分别是调用了+(Class)class方法和-(Class)class方法。</p>
<h4 id="7、isKindOfClass-和-isMemberOfClass-的实现"><a href="#7、isKindOfClass-和-isMemberOfClass-的实现" class="headerlink" title="7、isKindOfClass 和 isMemberOfClass 的实现"></a>7、isKindOfClass 和 isMemberOfClass 的实现</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)isKindOfClass:aClass &#123;</span><br><span class="line">Class cls;</span><br><span class="line"><span class="keyword">for</span> (cls = isa; cls; cls = cls-&gt;superclass) </span><br><span class="line"><span class="keyword">if</span> (cls == (Class)aClass)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)isMemberOfClass:aClass &#123;</span><br><span class="line"><span class="keyword">return</span> isa == (Class)aClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解析：[A isKindOfClass:aClass]; 先取A的isa假定为B，跟aClass比，不等的话，用B的superClass（假定为C）跟aClass比，不等的话，再去C的superClass跟aClass比，以此类推<br>[A isMemberOfClass:aClass]; 直接取A的isa假定为B，跟aClass比，返回比定结果</p>
<h4 id="五、自己在Xcode中做的测试"><a href="#五、自己在Xcode中做的测试" class="headerlink" title="五、自己在Xcode中做的测试"></a>五、自己在Xcode中做的测试</h4><p>// runtime.h部分方法<br><a href="/source/summary2_sample_1.zip">代码下载</a></p>
<p>// TestClang.m文件 和 通过 clang -rewrite-objc TestClang.m 命令生成的TestClang.cpp文件<br><a href="/source/summary2_sample_2.zip">代码下载</a></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[self class];</span></span><br><span class="line"><span class="comment">((Class (*)(id, SEL))(void *)objc_msgSend)    (  (id)self, sel_registerName("class")  )</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">id objc_msgSend(id self, SEL op, ...);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[super class];</span></span><br><span class="line"><span class="comment">((Class (*)(__rw_objc_super *, SEL))(void *)objc_msgSendSuper)   (  (__rw_objc_super)&#123; (id)self, (id)class_getSuperclass(objc_getClass("Son"))&#125;,     sel_registerName("class")    )</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">id objc_msgSendSuper(struct objc_super *super, SEL op, ...);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">struct objc_super &#123;</span></span><br><span class="line"><span class="comment">__unsafe_unretained id receiver;</span></span><br><span class="line"><span class="comment">__unsafe_unretained Class super_class;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="未完待续…"><a href="#未完待续…" class="headerlink" title="未完待续…"></a>未完待续…</h3><p>百度搜搜索：iOS大公司面试题、什么是Runtime、objc runtime.h<br><a href="http://www.aligoto.com/ios/ios-book/4504.html" target="_blank" rel="noopener">http://www.aligoto.com/ios/ios-book/4504.html</a></p>
<p>在OC中，任何一个对象都是一个指针，它所存储的值指向的是一个C语言的结构体，当然这个指针也有自己的地址和所占的内存。我们对对象的操作其实都是在直接操作它所存储指针。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      


        
        <div>
        
        
        </div>
        


    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/20/1、开篇，对字符串或者数组进行copy、mutableCopy操作的一些研究/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李乾">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李乾的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/20/1、开篇，对字符串或者数组进行copy、mutableCopy操作的一些研究/" itemprop="url">一、开篇，对字符串或者数组进行copy、mutableCopy操作的一些研究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-20T00:00:00+08:00">
                2017-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS面试总结及研究/" itemprop="url" rel="index">
                    <span itemprop="name">iOS面试总结及研究</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、首先看第六篇中的一个观点："><a href="#一、首先看第六篇中的一个观点：" class="headerlink" title="一、首先看第六篇中的一个观点："></a>一、首先看第六篇中的一个观点：</h3><blockquote>
<p>3、为什么str是不可变字符串的时候，self.copyedString = str是浅拷贝，而str是可变字符串的时候，self.copyedString = str是深拷贝？<br>我猜想这是苹果为了优化性能而故意为之吧。str是不可变字符串的时候，因为str不会发生改变，所以用浅拷贝。str是可变字符串的时候，因为str会发生改变，所以用深拷贝。<br>而显然，浅拷贝时，只是增加了引用计数，而深拷贝需要额外开辟内存空间。所以，为了更节省内存空间，才会这样做。</p>
</blockquote>
<p>引申：上面的例子是在声明属性时，在proprety中加copy的结果。接下来我们将对字符串调用copy和mutableCopy的方法。我想，调用后到底是做了深拷贝还是浅拷贝，其中的原理应该也跟上面的分析方法是一样的：系统会有限考虑节省内存，能节省内存就用浅拷贝，否则就用深拷贝。</p>
<h3 id="二、通过代码来分析："><a href="#二、通过代码来分析：" class="headerlink" title="二、通过代码来分析："></a>二、通过代码来分析：</h3><p><code>注意：下面打印&amp;str的值只是为了提醒自己，str是一个指针变量，既然是个变量那么也会有自己的地址。而实际上研究str自己的地址是没有什么意义的。</code></p>
<h4 id="1-NSString-copy、mutableCopy"><a href="#1-NSString-copy、mutableCopy" class="headerlink" title="1. NSString  | copy、mutableCopy"></a>1. NSString  | copy、mutableCopy</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"123"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *str_copy = str.copy;</span><br><span class="line"><span class="built_in">NSMutableString</span> *str_mutableCopy = str.mutableCopy;  <span class="comment">// 注意：这里str_mutableCopy是NSMutableString类型的</span></span><br><span class="line"></span><br><span class="line">[str_mutableCopy appendString:<span class="string">@"abc"</span>]; <span class="comment">// 改变mstr的值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"str：%@, %#x, %p"</span>, str, str, &amp;str);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"str_copy：%@, %#x, %p"</span>, str_copy, str_copy, &amp;str_copy);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"str_mutableCopy：%@, %#x, %p"</span>, str_mutableCopy, str_mutableCopy, &amp;str_mutableCopy);</span><br></pre></td></tr></table></figure>
<p>打印结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str：123, 0x3332313, 0x16fd6df18</span><br><span class="line">str_copy：123, 0x3332313, 0x16fd6df10</span><br><span class="line">str_mutableCopy：123abc, 0x7406d2c0, 0x16fd6df08</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>分析：</strong>很显然，str和str_copy都是不可变类型的，在任何时候，它们指向的地址(<code>0x3332313</code>)代表的值(<code>123</code>)不可能再发生改变，所以为了节省内存，我们只需要浅拷贝，因为我们不需要去担心谁的值会发生改变而造成不想要的结果。<br>而str_mutableCopy是可变类型，可以看出，它指向的地址(<code>0x7406d2c0</code>)和str指向的地址(<code>0x3332313</code>)是不同的，相当于深拷贝。为什么要用深拷贝呢？我们在后面加了一句代码：[str_mutableCopy appendString:@”abc”]来改变str_mutableCopy的值，很显然str_mutableCopy变成了<code>123abc</code>，此时我们肯定是不希望str和str_copy也跟着变成<code>123abc</code>，而是希望它们保持原值<code>123</code>。<br>所以str_copy是浅拷贝，str_mutableCopy是深拷贝。</p>
</blockquote>
<h4 id="2-NSMutableString-copy、mutableCopy"><a href="#2-NSMutableString-copy、mutableCopy" class="headerlink" title="2. NSMutableString  |  copy、mutableCopy"></a>2. NSMutableString  |  copy、mutableCopy</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableString</span> *mstr = [<span class="built_in">NSMutableString</span> stringWithFormat:<span class="string">@"123"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *mstr_copy = mstr.copy; <span class="comment">// 注意：这里mstr_copy是NSString类型的</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *mstr_mutableCopy = mstr.mutableCopy;</span><br><span class="line"></span><br><span class="line">[mstr appendString:<span class="string">@"abc"</span>]; <span class="comment">// 改变mstr的值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"mstr：%@, %#x, %p"</span>, mstr, mstr, &amp;mstr);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"mstr_copy：%@, %#x, %p"</span>, mstr_copy, mstr_copy, &amp;mstr_copy);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"mstr_mutableCopy：%@, %#x, %p"</span>, mstr_mutableCopy, mstr_mutableCopy, &amp;mstr_mutableCopy);</span><br></pre></td></tr></table></figure>
<p>打印结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mstr：123abc, 0x70079e00, 0x16fd19f18</span><br><span class="line">mstr_copy：123, 0x3332313, 0x16fd19f10</span><br><span class="line">mstr_mutableCopy：123, 0x70079e40, 0x16fd19f08</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>分析：</strong>显然，对于一个NSMutableString类型的字符串mstr来说，对它进行copy和mutableCopy，都会进行深拷贝。因为mstr的值随时都可能会改变，而我们不希望因此改变mstr_copy和mstr_mutableCopy的值。</p>
</blockquote>
<h4 id="3-NSArray-copy、mutableCopy"><a href="#3-NSArray-copy、mutableCopy" class="headerlink" title="3. NSArray | copy、mutableCopy"></a>3. NSArray | copy、mutableCopy</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *array = @[</span><br><span class="line">[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"1"</span>],</span><br><span class="line">[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"2"</span>],</span><br><span class="line">[<span class="built_in">NSMutableString</span> stringWithFormat:<span class="string">@"3"</span>],</span><br><span class="line">[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"4"</span>]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSArray</span> *array_copy = array.copy;</span><br><span class="line"><span class="built_in">NSMutableArray</span> *arr_mutableCopy = array.mutableCopy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变其中一个元素的值</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *str = arr_mutableCopy[<span class="number">2</span>];</span><br><span class="line">[str appendString:<span class="string">@"abc"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"array： %#x, %p"</span>, array, &amp;array);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"array_copy： %#x, %p"</span>, array_copy, &amp;array_copy);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"arr_mutableCopy：%#x, %p"</span>, arr_mutableCopy, &amp;arr_mutableCopy);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"---------------------------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> array) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"array：str：%@, %#x, %p"</span>, str, str, &amp;str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"---------------------------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> array_copy) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"array_copy：str：%@, %#x, %p"</span>, str, str, &amp;str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"---------------------------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> arr_mutableCopy) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"arr_mutableCopy：str：%@, %#x, %p"</span>, str, str, &amp;str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">array： 0x7004e5e0, 0x16fd89d60</span><br><span class="line">array_copy： 0x7004e5e0, 0x16fd89d58</span><br><span class="line">arr_mutableCopy：0x7004e370, 0x16fd89d50</span><br><span class="line">---------------------------------------</span><br><span class="line">array：str：1, 0x311, 0x16fd89d40</span><br><span class="line">array：str：2, 0x321, 0x16fd89d40</span><br><span class="line">array：str：3abc, 0x70072f00, 0x16fd89d40</span><br><span class="line">array：str：4, 0x341, 0x16fd89d40</span><br><span class="line">---------------------------------------</span><br><span class="line">array_copy：str：1, 0x311, 0x16fd89cf8</span><br><span class="line">array_copy：str：2, 0x321, 0x16fd89cf8</span><br><span class="line">array_copy：str：3abc, 0x70072f00, 0x16fd89cf8</span><br><span class="line">array_copy：str：4, 0x341, 0x16fd89cf8</span><br><span class="line">---------------------------------------</span><br><span class="line">arr_mutableCopy：str：1, 0x311, 0x16fd89cb0</span><br><span class="line">arr_mutableCopy：str：2, 0x321, 0x16fd89cb0</span><br><span class="line">arr_mutableCopy：str：3abc, 0x70072f00, 0x16fd89cb0</span><br><span class="line">arr_mutableCopy：str：4, 0x341, 0x16fd89cb0</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>分析：array_copy 和 array 指向的地址都是一样的(<code>0x7004e5e0</code>)，说明，array_copy对数组array进行了浅拷贝；arr_mutableCopy事项的地址是(<code>0x7004e370</code>)，和array的不一样，说明arr_mutableCopy对数组array进行了深拷贝；</p>
</blockquote>
<blockquote>
<p>对数组内部元素来说，array_copy、arr_mutableCopy跟array的内部元素对应指向的地址都是一样的(<code>分别是：0x311, 0x321, 0x70072f00, 0x341</code>)，所以内部元素相当于被retain了而已，也就是说内部元素是浅拷贝。所以我在代码中间改变了第3个元素的值，发觉所有的数组第三个值都被改变了。</p>
</blockquote>
<h4 id="4-NSMutableArray-copy、mutableCopy"><a href="#4-NSMutableArray-copy、mutableCopy" class="headerlink" title="4. NSMutableArray | copy、mutableCopy"></a>4. NSMutableArray | copy、mutableCopy</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *marray = [<span class="built_in">NSMutableArray</span> arrayWithObjects:</span><br><span class="line">[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"1"</span>],</span><br><span class="line">[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"2"</span>],</span><br><span class="line">[<span class="built_in">NSMutableString</span> stringWithFormat:<span class="string">@"3"</span>],</span><br><span class="line">[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"4"</span>], <span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSArray</span> *marray_copy = marray.copy;</span><br><span class="line"><span class="built_in">NSMutableArray</span> *marr_mutableCopy = marray.mutableCopy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变其中一个元素的值</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *str = marr_mutableCopy[<span class="number">2</span>];</span><br><span class="line">[str appendString:<span class="string">@"abc"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"marray： %#x, %p"</span>, marray, &amp;marray);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"marray_copy： %#x, %p"</span>, marray_copy, &amp;marray_copy);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"marr_mutableCopy：%#x, %p"</span>, marr_mutableCopy, &amp;marr_mutableCopy);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"---------------------------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> marray) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"marray：%@, %#x, %p"</span>, str, str, &amp;str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"---------------------------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> marray_copy) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"marray_copy：%@, %#x, %p"</span>, str, str, &amp;str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"---------------------------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *str <span class="keyword">in</span> marr_mutableCopy) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"marr_mutableCopy：%@, %#x, %p"</span>, str, str, &amp;str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">marray： 0x7004be80, 0x16fd7dd80</span><br><span class="line">marray_copy： 0x7004bb50, 0x16fd7dd78</span><br><span class="line">marr_mutableCopy：0x7004bb20, 0x16fd7dd70</span><br><span class="line">---------------------------------------</span><br><span class="line">marray：1, 0x311, 0x16fd7dd60</span><br><span class="line">marray：2, 0x321, 0x16fd7dd60</span><br><span class="line">marray：3abc, 0x70269fc0, 0x16fd7dd60</span><br><span class="line">marray：4, 0x341, 0x16fd7dd60</span><br><span class="line">---------------------------------------</span><br><span class="line">marray_copy：1, 0x311, 0x16fd7dd18</span><br><span class="line">marray_copy：2, 0x321, 0x16fd7dd18</span><br><span class="line">marray_copy：3abc, 0x70269fc0, 0x16fd7dd18</span><br><span class="line">marray_copy：4, 0x341, 0x16fd7dd18</span><br><span class="line">---------------------------------------</span><br><span class="line">marr_mutableCopy：1, 0x311, 0x16fd7dcd0</span><br><span class="line">marr_mutableCopy：2, 0x321, 0x16fd7dcd0</span><br><span class="line">marr_mutableCopy：3abc, 0x70269fc0, 0x16fd7dcd0</span><br><span class="line">marr_mutableCopy：4, 0x341, 0x16fd7dcd0</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>分析：</p>
</blockquote>
<p><a href="http://www.cnblogs.com/ydhliphonedev/archive/2012/04/27/2473927.html" target="_blank" rel="noopener">http://www.cnblogs.com/ydhliphonedev/archive/2012/04/27/2473927.html</a></p>
<p><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html</a></p>
<p>1、堆和栈的区别：<a href="http://www.jianshu.com/p/c8e1d91dda99" target="_blank" rel="noopener">http://www.jianshu.com/p/c8e1d91dda99</a><br>2、深拷贝与浅拷贝：<a href="http://www.cnblogs.com/yswdarren/p/3611924.html" target="_blank" rel="noopener">http://www.cnblogs.com/yswdarren/p/3611924.html</a><br>3、retainCount打印为-1：<a href="http://www.jianshu.com/p/ddf49659ea6f" target="_blank" rel="noopener">http://www.jianshu.com/p/ddf49659ea6f</a></p>
<p><a href="/source/summary0_sample_1.zip">代码下载</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      


        
        <div>
        
        
        </div>
        


    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar/avatar.jpeg"
                alt="李乾" />
            
              <p class="site-author-name" itemprop="name">李乾</p>
              <p class="site-description motion-element" itemprop="description">人生不止眼前的苟且 还有诗和远方</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">45</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xiamoon" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李乾</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
